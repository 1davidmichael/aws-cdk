#!/bin/bash
# Wrapper for 'npm' which will append a strict version to module installation.
set -eu

command=$1

NPM_INSTALL_PACKAGE_SUFFIX=${NPM_INSTALL_PACKAGE_SUFFIX:-@${CANDIDATE_VERSION}}

if [[ "$command" == "install" || "$command" == "i" ]]; then

  shift

  while [[ "${1:-}" != "" ]]; do
    echo "Installing ${1}${NPM_INSTALL_PACKAGE_SUFFIX}"
    $ORIGINAL_NPM install ${1}${NPM_INSTALL_PACKAGE_SUFFIX}
    shift
  done

else

  exec $ORIGINAL_NPM "$@"

fi